(()=>{var e={380:e=>{var o={config:{baseURL:"//qa-api-developer.sephora.com/v1/sot",debug:!1,allowTracking:!0,useSendBeacon:!0,apiKey:"JJZW6eiIX6W8s9Fm7vQ3v3pzj2flTOYm",cookieSetTimeout:100,MVPfields:{}},util:{readCookie:function(e){for(var o=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var i=n[t];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(o))return i.substring(o.length,i.length)}return null},setCookie:function(e,o,n){n||(n=15768e4),document.cookie=e+"="+o+"; Secure; path=/; domain=.sephora.com; max-age="+n},deleteCookie:function(e){this.setCookie(e,"",-1)},log:function(e){o.config.debug&&console.log(e)},xhrQueue:[],getReferrer:function(){return this.readCookie("referrer")||""},setReferrer:function(){const e=this.getReferrer("referrer"),o=/.*\.sephora\..*/.test(document.referrer),n=document.referrer&&!o;!e||document.referrer?n&&(e&&e===document.referrer||this.setCookie("referrer",document.referrer)):this.deleteCookie("referrer")}},setConfig:function(e,o){for(var n in e)e.hasOwnProperty(n)&&(this.config[n]=e[n]);o&&"function"==typeof o&&o()},commandQueue:function(){}};o.commandQueue.prototype={loadCmds:function(e){this.asyncCmds=e},push:function(e,n){var t=Array.prototype.slice.call(e,1),i="SephoraOneTagTracker",r=e[0];void 0===window[i]&&(o.util.log("Sephora One Tag :: Creating Tracker."),window[i]=new o.tracker),o.config.allowTracking?(t.push(n),window[i][r].apply(window[i],t)):o.util.log("Sephora One Tag :: Tracking is disabled")},process:function(){var e=this;this.asyncCmds&&this.asyncCmds.length>0&&this.push(this.asyncCmds.shift(),(function(){e.asyncCmds.length>0&&e.process()})),o.util.setReferrer()}},o.tracker=function(){},inactiveTime=function(){var e;function n(){o.util.log("No user activity for 20 mins.")}function t(){clearTimeout(e),e=setTimeout(n,12e5)}window.onload=t,document.onmousemove=t,document.onkeydown=t},window.onload=function(){inactiveTime()},o.tracker.prototype={screenResolution:function(){return window.screen.width+"x"+window.screen.height},viewportSize:function(){var e=new Object;return e.width=window.innerWidth?window.innerWidth:document.body.offsetWidth,e.height=window.innerHeight?window.innerHeight:document.body.offsetHeight,e.width+"x"+e.height},pagePerformance:function(){var e=window.performance.timing,o=e.loadEventEnd-e.navigationStart;return{dnsLookupTime:e.domainLookupEnd-e.domainLookupStart,pageDownloadTime:e.responseEnd-e.responseStart,tcpConnectionTime:e.connectEnd-e.connectStart,serverResponseTime:e.responseStart-e.requestStart,domInteractiveTime:e.domInteractive-e.navigationStart,contentLoadTime:e.domContentLoadedEventEnd-e.navigationStart,pageLoadTime:o}},trackPageView:function(e,n,t,i){o.util.log("Sephora One Tag :: Tracking page view");var r=this,s={sysInfo:{screenResolution:this.screenResolution(),viewPortSize:this.viewportSize(),charSet:document.characterSet,colorDepth:window.screen.colorDepth,javaEnabled:navigator.javaEnabled()},pageInfo:{hostName:window.location.hostname,path:document.location.pathname,url:document.location.href},campaign:{referrer:o.util.getReferrer()},sotVars:{sotType:"page view"},session:{},performance:{},apikey:o.config.apiKey},a=this.pagePerformance();for(var c in a)a.hasOwnProperty(c)&&(s.performance[c]=a[c]);for(var c in e)if(e.hasOwnProperty(c))if("object"!=typeof e[c]||Array.isArray(e[c])||null===e[c])s[c]=e[c];else for(var u in s[c]||(s[c]={}),e[c])null!==e[c][u]&&void 0!==e[c][u]&&""!==e[c][u]&&(s[c][u]=e[c][u]);this.checkAndCreateSotID((function(e){s.session||(s.session={}),s.session.sotTrackingId=o.util.readCookie("sti"),!s.session.sotTrackingId&&e&&(s.session.sotTrackingId=e),r.createOrExtendSessionID(e),s.session.sessionId=o.util.readCookie("ssi"),!s.session.sessionId&&e&&(s.session.sessionId=e+"."+(new Date).getTime());var a=o.config.MVPfields.Page_View?o.config.MVPfields.Page_View:[];r.callTrackAPI(s,a,t,i),n&&"function"==typeof n&&n()}))},trackEvent:function(e,n,t,i=!1,r=!1){o.util.log("Sephora One Tag :: Tracking event");var s=this,a={sysInfo:{screenResolution:this.screenResolution(),viewPortSize:this.viewportSize(),charSet:document.characterSet,colorDepth:window.screen.colorDepth,javaEnabled:navigator.javaEnabled()},pageInfo:{hostName:window.location.hostname,path:document.location.pathname,url:document.location.href},campaign:{referrer:o.util.getReferrer()},sotVars:{sotType:e},session:{},apikey:o.config.apiKey};for(var c in n)if(n.hasOwnProperty(c))if("object"!=typeof n[c]||Array.isArray(n[c])||null===n[c])a[c]=n[c];else for(var u in a[c]||(a[c]={}),n[c])null!==n[c][u]&&void 0!==n[c][u]&&""!==n[c][u]&&(a[c][u]=n[c][u]);this.checkAndCreateSotID((function(n){a.session||(a.session={}),a.session.sotTrackingId=o.util.readCookie("sti"),!a.session.sotTrackingId&&n&&(a.session.sotTrackingId=n),s.createOrExtendSessionID(n),a.session.sessionId=o.util.readCookie("ssi"),!a.session.sessionId&&n&&(a.session.sessionId=n+"."+(new Date).getTime());var c=String(e).replaceAll(" ","_"),u=o.config.MVPfields[c]?o.config.MVPfields[c]:[];s.callTrackAPI(a,u,i,r),t&&"function"==typeof t&&t()}))},validateMVPfields:function(e,o,n,t){var i=[],r=[],s=e.session&&e.session.sotTrackingId;return o&&o.length>0&&(o.forEach((o=>{var n=this.findKey(e,o);n&&i.push(n)})),o.forEach((e=>{-1===i.indexOf(e)&&r.push(e)}))),r.length>0?(this.makeSotErrorCall(e,`Missing Fields in payload: ${JSON.stringify(r)}`,n,t),!1):null!=s&&"null"!==s&&""!==s||(this.makeSotErrorCall(e,"Missing sotTrackingId in payload",n,t),!1)},findKey(e,o){for(var n in e){if(n==o)return o;if(e[n]instanceof Object&&(result=this.findKey(e[n],o),result))return result}},makeSotErrorCall:function(e,n,t,i){var r=new XMLHttpRequest;e.errorReason=n,e.error=!0,(t||i)&&(e.apikey=o.config.apiKey,delete e.performance,delete e.sotProps,delete e.error),r.open("POST",o.config.baseURL+"/evtError?apikey="+o.config.apiKey,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Authorization","Bearer "+o.config.apiKey),r.withCredentials=!0,r.send(JSON.stringify(e))},makeXHRCall:function(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE){var t,i,r=n.status;0===r||r>=200&&r<400?(t=n.response,o.util.log("Sephora One Tag :: Setup of sotTrackingId(sti) cookie successfull! :: "+t)):o.util.log("Sephone One Tag :: Setup of sotTrackingId(sti) cookie failed."),t&&(t=JSON.parse(t)),t&&t.trackingId&&(i=t.trackingId,sessionStorage.setItem("sti",i)),setTimeout(function(n){e(n);for(var t=1;t<o.util.xhrQueue.length;t++)o.util.xhrQueue[t](n);o.util.xhrQueue=[],o.util.log("Sephora One Tag :: Making callback for checkAndCreateSotId :: timeout :: "+o.config.cookieSetTimeout+" :: trackingId in response is :: "+n)}(i),o.config.cookieSetTimeout)}},n.open("GET",o.config.baseURL+"/trackingId?apikey="+o.config.apiKey),n.withCredentials=!0,n.send()},checkAndCreateSotID:function(e){var n=o.util.readCookie("sti");n?sessionStorage.setItem("sti",n):(n=sessionStorage.getItem("sti"))&&o.util.setCookie("sti",n),n?(o.util.log("Sephora One Tag :: sotTrackingId(sti) found :: "+n),e(n)):(o.util.log("Sephora One Tag :: sotTrackingId not found"),e&&o.util.xhrQueue.push(e),o.util.xhrQueue.length<=1?(o.util.log("Sephora One Tag :: makeXhrcall"),this.makeXHRCall(e)):o.util.log("Sephora One Tag :: queue makeXhrcall callback"))},createOrExtendSessionID:function(e){var n=o.util.readCookie("ssi");if(n)o.util.log("Sephora One Tag :: sotSessionId(ssi) found :: "+n),o.util.log("Sephora One Tag :: Extend sotSessionId"),o.util.setCookie("ssi",n,1800);else{var t=o.util.readCookie("sti");t||(t=e);var i=t+"."+(new Date).getTime();o.util.log("Sephora One Tag :: sotSessionId not found"),o.util.log("Sephora One Tag :: Create sotSessionId"),o.util.setCookie("ssi",i,1800)}},switchBaseUrl:function(e,n,t){t?o.config.baseURL=o.config.baseURL.replace(new RegExp(e),n):o.config.baseURL.includes(n)&&(o.config.baseURL=o.config.baseURL.replace(new RegExp(n),e))},callTrackAPI:function(e,n,t,i){if(!this.validateMVPfields(e,n,t,i))return;for(var r in e)null!==e[r]&&void 0!==e[r]&&""!==e[r]||delete e[r];var s=!1;this.switchBaseUrl("sot","notify",i);const a=t?"/evtTopic":i?"/osscss":"/evt",c=i?"":`?apikey=${o.config.apiKey}`,u=o.config.baseURL+a+c;if(o.config.useSendBeacon&&navigator.sendBeacon&&window.Blob&&!i){var l=new Blob([JSON.stringify(e)],{type:"application/json",authorization:"Bearer "+o.config.apiKey});s=navigator.sendBeacon(u,l)}if(!s){o.util.log("Sephora One Tag :: Using XHR for transport");var d=new XMLHttpRequest;d.onload=function(){d.status>=200&&d.status<300?o.util.log("Sephora One Tag :: Hit successfull!"):o.util.log("Sephone One Tag :: Hit failed.")},d.open("POST",u,!0),d.setRequestHeader("Content-Type","application/json"),i&&d.setRequestHeader("x-api-key",o.config.apiKey),d.setRequestHeader("Authorization","Bearer "+o.config.apiKey),d.withCredentials=!0,d.send(JSON.stringify(e))}},setAllowTracking:function(e,n){o.setConfig({allowTracking:e},n)},setUseSendBeacon:function(e,n){o.setConfig({useSendBeacon:e},n)},setDebug:function(e,n){o.setConfig({debug:e},n)},setBaseURL:function(e,n){o.setConfig({baseURL:e},n)},setApiKey:function(e,n){o.setConfig({apiKey:e},n)},setCookieSetTimeout:function(e,n){o.setConfig({cookieSetTimeout:e},n)}},function(){if("undefined"==typeof sephoraOneTag_cmds)var e=new o.commandQueue;else(e=new o.commandQueue).loadCmds(sephoraOneTag_cmds);window.sephoraOneTag_cmds=e,window.sephoraOneTag_cmds.process()}(),e.exports=o}},o={};function n(t){var i=o[t];if(void 0!==i)return i.exports;var r=o[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return n.d(o,{a:o}),o},n.d=(e,o)=>{for(var t in o)n.o(o,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},n.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{"use strict";n(380)})()})();